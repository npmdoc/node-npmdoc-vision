<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/hapijs/vision#readme"

    >vision (v4.1.1)</a>
</h1>
<h4>Templates rendering plugin support for hapi.js</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.vision">module vision</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager">
            function <span class="apidocSignatureSpan">vision.</span>manager
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.register">
            function <span class="apidocSignatureSpan">vision.</span>register
            <span class="apidocSignatureSpan">(server, pluginOptions, next)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">vision.</span>manager.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.vision.manager">module vision.manager</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.manager">
            function <span class="apidocSignatureSpan">vision.</span>manager
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.vision.manager.prototype">module vision.manager.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._compile">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_compile
            <span class="apidocSignatureSpan">(template, engine, settings, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._loadHelpers">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_loadHelpers
            <span class="apidocSignatureSpan">(engine)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._loadPartials">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_loadPartials
            <span class="apidocSignatureSpan">(engine)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._path">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_path
            <span class="apidocSignatureSpan">(template, settings, isLayout, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._prepare">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_prepare
            <span class="apidocSignatureSpan">(template, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._prepareEngine">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_prepareEngine
            <span class="apidocSignatureSpan">(engine, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._prepareTemplates">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_prepareTemplates
            <span class="apidocSignatureSpan">(template, engine, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._render">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_render
            <span class="apidocSignatureSpan">(compiled, context, request, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype._response">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_response
            <span class="apidocSignatureSpan">(template, context, options, request)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype.registerHelper">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>registerHelper
            <span class="apidocSignatureSpan">(name, helper)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.vision.manager.prototype.render">
            function <span class="apidocSignatureSpan">vision.manager.prototype.</span>render
            <span class="apidocSignatureSpan">(filename, context, options, callback)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.vision" id="apidoc.module.vision">module vision</a></h1>


    <h2>
        <a href="#apidoc.element.vision.manager" id="apidoc.element.vision.manager">
        function <span class="apidocSignatureSpan">vision.</span>manager
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">manager = function (options) {

    Joi.assert(options, internals.schema.manager);

    // Save non-defaults values

    const engines = options.engines;
    const defaultExtension = options.defaultExtension;

    // Clone options

    const defaults = Hoek.applyToDefaultsWithShallow(internals.defaults, options, [&#x27;engines&#x27;, &#x27;context&#x27;]);
    delete defaults.engines;
    delete defaults.defaultExtension;

    // Prepare manager state

    const extensions = Object.keys(engines);
    Hoek.assert(extensions.length, &#x27;Views manager requires at least one registered extension handler&#x27;);

    this._context = defaults.context;
    this._engines = {};
    this._defaultExtension = defaultExtension || (extensions.length === 1 ? extensions[0] : &#x27;&#x27;);

    // Load engines

    extensions.forEach((extension) =&#x3e; {

        const config = engines[extension];
        const engine = {};

        if (config.compile &#x26;&#x26;
            typeof config.compile === &#x27;function&#x27;) {

            engine.module = config;
            engine.config = defaults;
        }
        else {
            Joi.assert(config, internals.schema.view);

            engine.module = config.module;
            engine.config = Hoek.applyToDefaultsWithShallow(defaults, config, [&#x27;module&#x27;]);
        }

        engine.suffix = &#x27;.&#x27; + extension;
        engine.compileFunc = engine.module.compile;

        if (engine.config.compileMode === &#x27;sync&#x27;) {
            engine.compileFunc = function (str, opt, next) {

                let compiled = null;
                try {
                    compiled = engine.module.compile(str, opt);
                }
                catch (err) {
                    return next(err);
                }

                const renderer = function (context, runtimeOptions, renderNext) {

                    let rendered = null;
                    try {
                        rendered = compiled(context, runtimeOptions);
                    }
                    catch (err) {
                        return renderNext(err);
                    }

                    return renderNext(null, rendered);
                };

                return next(null, renderer);
            };
        }

        if (engine.config.isCached) {
            engine.cache = {};
        }

        // When a prepare function is provided, state needs to be initialized before trying to compile and render
        engine.ready = !(engine.module.prepare &#x26;&#x26; typeof engine.module.prepare === &#x27;function&#x27;);

        // Load partials and helpers

        this._loadPartials(engine);
        this._loadHelpers(engine);

        // Set engine

        this._engines[extension] = engine;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.register" id="apidoc.element.vision.register">
        function <span class="apidocSignatureSpan">vision.</span>register
        <span class="apidocSignatureSpan">(server, pluginOptions, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">register = function (server, pluginOptions, next) {

    server.decorate(&#x27;server&#x27;, &#x27;views&#x27;, function (options) {

        Hoek.assert(options, &#x27;Missing views options&#x27;);
        this.realm.plugins.vision = this.realm.plugins.vision || {};
        Hoek.assert(!this.realm.plugins.vision.manager, &#x27;Cannot set views manager more than once&#x27;);

        if (!options.relativeTo &#x26;&#x26;
            this.realm.settings.files.relativeTo) {

            options = Hoek.shallow(options);
            options.relativeTo = this.realm.settings.files.relativeTo;
        }

        const manager = new Manager(options);
        this.realm.plugins.vision.manager = manager;
        return manager;
    });

    server.decorate(&#x27;server&#x27;, &#x27;render&#x27;, internals.render);
    server.decorate(&#x27;request&#x27;, &#x27;render&#x27;, internals.render);

    server.handler(&#x27;view&#x27;, internals.handler);

    server.decorate(&#x27;reply&#x27;, &#x27;view&#x27;, function (template, context, options) {

        const realm = (this.realm.plugins.vision || this.request.server.realm.plugins.vision || {});
        Hoek.assert(realm.manager, &#x27;Cannot render view without a views manager configured&#x27;);
        return this.response(realm.manager._response(template, context, options, this.request));
    });

    return next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

**You will need to install `vision` using something like `npm install --save vision` before you can register it.**

```js
const server = new Hapi.Server();
server.connection({ port: 8080 });

server.<span class="apidocCodeKeywordSpan">register</span>(require(&#x27;vision&#x27;), (err) =&#x3e; {

    if (err) {
        console.log(&#x22;Failed to load vision.&#x22;);
    }
});
```
**NOTE:** Vision is included with and loaded by default in Hapi &#x3c; 9.0.
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.vision.manager" id="apidoc.module.vision.manager">module vision.manager</a></h1>


    <h2>
        <a href="#apidoc.element.vision.manager.manager" id="apidoc.element.vision.manager.manager">
        function <span class="apidocSignatureSpan">vision.</span>manager
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">manager = function (options) {

    Joi.assert(options, internals.schema.manager);

    // Save non-defaults values

    const engines = options.engines;
    const defaultExtension = options.defaultExtension;

    // Clone options

    const defaults = Hoek.applyToDefaultsWithShallow(internals.defaults, options, [&#x27;engines&#x27;, &#x27;context&#x27;]);
    delete defaults.engines;
    delete defaults.defaultExtension;

    // Prepare manager state

    const extensions = Object.keys(engines);
    Hoek.assert(extensions.length, &#x27;Views manager requires at least one registered extension handler&#x27;);

    this._context = defaults.context;
    this._engines = {};
    this._defaultExtension = defaultExtension || (extensions.length === 1 ? extensions[0] : &#x27;&#x27;);

    // Load engines

    extensions.forEach((extension) =&#x3e; {

        const config = engines[extension];
        const engine = {};

        if (config.compile &#x26;&#x26;
            typeof config.compile === &#x27;function&#x27;) {

            engine.module = config;
            engine.config = defaults;
        }
        else {
            Joi.assert(config, internals.schema.view);

            engine.module = config.module;
            engine.config = Hoek.applyToDefaultsWithShallow(defaults, config, [&#x27;module&#x27;]);
        }

        engine.suffix = &#x27;.&#x27; + extension;
        engine.compileFunc = engine.module.compile;

        if (engine.config.compileMode === &#x27;sync&#x27;) {
            engine.compileFunc = function (str, opt, next) {

                let compiled = null;
                try {
                    compiled = engine.module.compile(str, opt);
                }
                catch (err) {
                    return next(err);
                }

                const renderer = function (context, runtimeOptions, renderNext) {

                    let rendered = null;
                    try {
                        rendered = compiled(context, runtimeOptions);
                    }
                    catch (err) {
                        return renderNext(err);
                    }

                    return renderNext(null, rendered);
                };

                return next(null, renderer);
            };
        }

        if (engine.config.isCached) {
            engine.cache = {};
        }

        // When a prepare function is provided, state needs to be initialized before trying to compile and render
        engine.ready = !(engine.module.prepare &#x26;&#x26; typeof engine.module.prepare === &#x27;function&#x27;);

        // Load partials and helpers

        this._loadPartials(engine);
        this._loadHelpers(engine);

        // Set engine

        this._engines[extension] = engine;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.vision.manager.prototype" id="apidoc.module.vision.manager.prototype">module vision.manager.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.vision.manager.prototype._compile" id="apidoc.element.vision.manager.prototype._compile">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_compile
        <span class="apidocSignatureSpan">(template, engine, settings, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_compile = function (template, engine, settings, callback) {

    if (engine.cache &#x26;&#x26;
        engine.cache[template]) {

        return callback(null, engine.cache[template]);
    }

    settings.compileOptions.filename = template;            // Pass the template to Jade via this copy of compileOptions

    // Read file

    Fs.readFile(template, { encoding: settings.encoding }, (err, data) =&#x3e; {

        if (err) {
            return callback(Boom.badImplementation(&#x27;Failed to read view file: &#x27; + template));
        }

        engine.compileFunc(data, settings.compileOptions, (err, compiled) =&#x3e; {

            if (err) {
                return callback(Boom.wrap(err));
            }

            if (engine.cache) {
                engine.cache[template] = compiled;
            }

            return callback(null, compiled);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    this._path(template, compiled.settings, false, (err, templatePath) =&#x3e; {

        if (err) {
return callback(err);
        }

        this.<span class="apidocCodeKeywordSpan">_compile</span>(templatePath, engine, compiled.settings, (err, compiledTemplate
) =&#x3e; {

if (err) {
    return callback(err);
}

compiled.template = compiledTemplate;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._loadHelpers" id="apidoc.element.vision.manager.prototype._loadHelpers">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_loadHelpers
        <span class="apidocSignatureSpan">(engine)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadHelpers = function (engine) {

    if (!engine.config.helpersPath ||
        !engine.module.registerHelper ||
        typeof engine.module.registerHelper !== &#x27;function&#x27;) {

        return;
    }

    const helpersPaths = [].concat(engine.config.helpersPath);

    helpersPaths.forEach((helpersPath) =&#x3e; {

        let path = internals.path(engine.config.relativeTo, helpersPath);
        if (!Path.isAbsolute(path)) {
            path = Path.join(process.cwd(), path);
        }

        Fs.readdirSync(path).forEach((file) =&#x3e; {

            file = Path.join(path, file);
            const stat = Fs.statSync(file);
            if (!stat.isDirectory() &#x26;&#x26;
                Path.basename(file)[0] !== &#x27;.&#x27;) {

                try {
                    const helper = require(file);
                    if (typeof helper === &#x27;function&#x27;) {
                        const offset = path.slice(-1) === Path.sep ? 0 : 1;
                        const name = file.slice(path.length + offset, -Path.extname(file).length);
                        engine.module.registerHelper(name, helper);
                    }
                }
                catch (err) {
                    console.warn(&#x27;WARNING: vision failed to load helper \&#x27;%s\&#x27;: %s&#x27;, file, err.message);
                }
            }
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        // When a prepare function is provided, state needs to be initialized before trying to compile and render
        engine.ready = !(engine.module.prepare &#x26;&#x26; typeof engine.module.prepare === &#x27;function&#x27;);

        // Load partials and helpers

        this._loadPartials(engine);
        this.<span class="apidocCodeKeywordSpan">_loadHelpers</span>(engine);

        // Set engine

        this._engines[extension] = engine;
    });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._loadPartials" id="apidoc.element.vision.manager.prototype._loadPartials">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_loadPartials
        <span class="apidocSignatureSpan">(engine)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadPartials = function (engine) {

    if (!engine.config.partialsPath ||
        !engine.module.registerPartial ||
        typeof engine.module.registerPartial !== &#x27;function&#x27;) {

        return;
    }

    const load = function () {

        const partialsPaths = [].concat(engine.config.partialsPath);

        partialsPaths.forEach((partialsPath) =&#x3e; {

            const path = internals.path(engine.config.relativeTo, partialsPath);
            const files = traverse(path);
            files.forEach((file) =&#x3e; {

                const offset = path.slice(-1) === Path.sep ? 0 : 1;
                const name = file.slice(path.length + offset, -engine.suffix.length).replace(/\\/g, &#x27;/&#x27;);
                const src = Fs.readFileSync(file).toString(engine.config.encoding);
                engine.module.registerPartial(name, src);
            });
        });
    };

    const traverse = function (path) {

        let files = [];

        Fs.readdirSync(path).forEach((file) =&#x3e; {

            file = Path.join(path, file);
            const stat = Fs.statSync(file);
            if (stat.isDirectory()) {
                files = files.concat(traverse(file));
                return;
            }

            if (Path.basename(file)[0] !== &#x27;.&#x27; &#x26;&#x26;
                Path.extname(file) === engine.suffix) {

                files.push(file);
            }
        });

        return files;
    };

    load();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        }

        // When a prepare function is provided, state needs to be initialized before trying to compile and render
        engine.ready = !(engine.module.prepare &#x26;&#x26; typeof engine.module.prepare === &#x27;function&#x27;);

        // Load partials and helpers

        this.<span class="apidocCodeKeywordSpan">_loadPartials</span>(engine);
        this._loadHelpers(engine);

        // Set engine

        this._engines[extension] = engine;
    });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._path" id="apidoc.element.vision.manager.prototype._path">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_path
        <span class="apidocSignatureSpan">(template, settings, isLayout, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_path = function (template, settings, isLayout, next) {

    // Validate path

    const isAbsolutePath = Path.isAbsolute(template);
    const isInsecurePath = template.match(/\.\.\//g);

    if (!settings.allowAbsolutePaths &#x26;&#x26;
        isAbsolutePath) {

        return next(Boom.badImplementation(&#x27;Absolute paths are not allowed in views&#x27;));
    }

    if (!settings.allowInsecureAccess &#x26;&#x26;
        isInsecurePath) {

        return next(Boom.badImplementation(&#x27;View paths cannot lookup templates outside root path (path includes one or more \&#x27;../\&#x27;)&#x27;));
    }

    // Resolve path and extension

    let paths;
    if (isAbsolutePath) {
        paths = [template];
    }
    else {
        paths = [].concat((isLayout &#x26;&#x26; settings.layoutPath) || settings.path);

        for (let i = 0; i &#x3c; paths.length; ++i) {
            paths[i] = internals.path(settings.relativeTo, paths[i], template);
        }
    }

    Items.serial(paths, (path, nextFile) =&#x3e; {

        Fs.stat(path, (err, stats) =&#x3e; {

            if (!err &#x26;&#x26;
                stats.isFile()) {

                return next(null, path);
            }

            return nextFile();
        });
    },
    () =&#x3e; {

        return next(Boom.badImplementation(&#x27;View file not found: `&#x27; + template + &#x27;`. Locations searched: [&#x27; + paths.join(&#x27;,&#x27;) + &#x27;]&#x27;));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

internals.Manager.prototype._prepareTemplates = function (template, engine, options, callback) {

    const compiled = {
settings: Hoek.applyToDefaults(engine.config, options)
    };

    this.<span class="apidocCodeKeywordSpan">_path</span>(template, compiled.settings, false, (err, templatePath) =&#x3e; {

if (err) {
    return callback(err);
}

this._compile(templatePath, engine, compiled.settings, (err, compiledTemplate) =&#x3e; {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._prepare" id="apidoc.element.vision.manager.prototype._prepare">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_prepare
        <span class="apidocSignatureSpan">(template, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepare = function (template, options, callback) {

    options = options || {};

    const fileExtension = Path.extname(template).slice(1);
    const extension = fileExtension || this._defaultExtension;
    if (!extension) {
        return callback(Boom.badImplementation(&#x27;Unknown extension and no defaultExtension configured for view template: &#x27; + template
));
    }

    const engine = this._engines[extension];
    if (!engine) {
        return callback(Boom.badImplementation(&#x27;No view engine found for file: &#x27; + template));
    }

    template = template + (fileExtension ? &#x27;&#x27; : engine.suffix);

    // Engine is ready to render

    if (engine.ready) {
        return this._prepareTemplates(template, engine, options, callback);
    }

    // Engine needs initialization

    return this._prepareEngine(engine, (err) =&#x3e; {

        if (err) {
            return callback(err);
        }

        return this._prepareTemplates(template, engine, options, callback);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

internals.Manager.prototype.render = function (filename, context, options, callback) {

    if (!callback) {
return internals._wrapMethod(this, this.render, [filename, context, options]);
    }

    this.<span class="apidocCodeKeywordSpan">_prepare</span>(filename, options, (err, compiled) =&#x3e; {

if (err) {
    return callback(err);
}

this._render(compiled, context, null, (err, rendered) =&#x3e; {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._prepareEngine" id="apidoc.element.vision.manager.prototype._prepareEngine">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_prepareEngine
        <span class="apidocSignatureSpan">(engine, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepareEngine = function (engine, next) {

    // _prepareEngine can only be invoked when the prepare function is defined

    try {
        return engine.module.prepare(engine.config, (err) =&#x3e; {

            if (err) {
                return next(err);
            }

            engine.ready = true;
            return next();
        });
    }
    catch (err) {
        return next(err);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (engine.ready) {
    return this._prepareTemplates(template, engine, options, callback);
}

// Engine needs initialization

return this.<span class="apidocCodeKeywordSpan">_prepareEngine</span>(engine, (err) =&#x3e; {

    if (err) {
        return callback(err);
    }

    return this._prepareTemplates(template, engine, options, callback);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._prepareTemplates" id="apidoc.element.vision.manager.prototype._prepareTemplates">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_prepareTemplates
        <span class="apidocSignatureSpan">(template, engine, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepareTemplates = function (template, engine, options, callback) {

    const compiled = {
        settings: Hoek.applyToDefaults(engine.config, options)
    };

    this._path(template, compiled.settings, false, (err, templatePath) =&#x3e; {

        if (err) {
            return callback(err);
        }

        this._compile(templatePath, engine, compiled.settings, (err, compiledTemplate) =&#x3e; {

            if (err) {
                return callback(err);
            }

            compiled.template = compiledTemplate;

            // No layout

            if (!compiled.settings.layout) {
                return callback(null, compiled);
            }

            // With layout

            this._path((compiled.settings.layout === true ? &#x27;layout&#x27; : compiled.settings.layout) + engine.suffix, compiled.settings
, true, (err, layoutPath) =&#x3e; {

                if (err) {
                    return callback(err);
                }

                this._compile(layoutPath, engine, compiled.settings, (err, layout) =&#x3e; {

                    if (err) {
                        return callback(err);
                    }

                    compiled.layout = layout;
                    return callback(null, compiled);
                });
            });
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }

    template = template + (fileExtension ? &#x27;&#x27; : engine.suffix);

    // Engine is ready to render

    if (engine.ready) {
return this.<span class="apidocCodeKeywordSpan">_prepareTemplates</span>(template, engine, options, callback);
    }

    // Engine needs initialization

    return this._prepareEngine(engine, (err) =&#x3e; {

if (err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._render" id="apidoc.element.vision.manager.prototype._render">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_render
        <span class="apidocSignatureSpan">(compiled, context, request, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_render = function (compiled, context, request, callback) {

    if (this._context) {
        let base = typeof this._context === &#x27;function&#x27; ? this._context(request) : this._context;
        if (context) {
            base = Hoek.shallow(base);
            const keys = Object.keys(context);
            for (let i = 0; i &#x3c; keys.length; ++i) {
                const key = keys[i];
                base[key] = context[key];
            }
        }

        context = base;
    }

    context = context || {};

    if (compiled.layout &#x26;&#x26;
        context.hasOwnProperty(compiled.settings.layoutKeyword)) {

        return callback(Boom.badImplementation(&#x27;settings.layoutKeyword conflict&#x27;, { context, keyword: compiled.settings.layoutKeyword
 }));
    }

    compiled.template(context, compiled.settings.runtimeOptions, (err, renderedContent) =&#x3e; {

        if (err) {
            return callback(Boom.badImplementation(err.message, err));
        }

        // No layout

        if (!compiled.layout) {
            return callback(null, renderedContent);
        }

        // With layout

        context[compiled.settings.layoutKeyword] = renderedContent;
        compiled.layout(context, compiled.settings.runtimeOptions, (err, renderedWithLayout) =&#x3e; {

            delete context[compiled.settings.layoutKeyword];

            if (err) {
                return callback(Boom.badImplementation(err.message, err));
            }

            return callback(null, renderedWithLayout);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    this._prepare(filename, options, (err, compiled) =&#x3e; {

if (err) {
    return callback(err);
}

this.<span class="apidocCodeKeywordSpan">_render</span>(compiled, context, null, (err, rendered) =&#x3e; {

    if (err) {
        return callback(err);
    }

    return callback(null, rendered, compiled.settings);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype._response" id="apidoc.element.vision.manager.prototype._response">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>_response
        <span class="apidocSignatureSpan">(template, context, options, request)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_response = function (template, context, options, request) {

    Joi.assert(options, internals.schema.viewOverride);

    const source = { manager: this, template, context, options };
    return request.generateResponse(source, { variety: &#x27;view&#x27;, marshal: internals.marshal, prepare: internals.prepare });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype.registerHelper" id="apidoc.element.vision.manager.prototype.registerHelper">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>registerHelper
        <span class="apidocSignatureSpan">(name, helper)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">registerHelper = function (name, helper) {

    Object.keys(this._engines).forEach((extension) =&#x3e; {

        const engine = this._engines[extension];

        if (typeof engine.module.registerHelper === &#x27;function&#x27;) {
            engine.module.registerHelper(name, helper);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        Path.basename(file)[0] !== &#x27;.&#x27;) {

        try {
            const helper = require(file);
            if (typeof helper === &#x27;function&#x27;) {
                const offset = path.slice(-1) === Path.sep ? 0 : 1;
                const name = file.slice(path.length + offset, -Path.extname(file).length);
                engine.module.<span class="apidocCodeKeywordSpan">registerHelper</span>(name, helper);
            }
        }
        catch (err) {
            console.warn(&#x27;WARNING: vision failed to load helper \&#x27;%s\&#x27;: %s&#x27;, file, err.message);
        }
    }
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.vision.manager.prototype.render" id="apidoc.element.vision.manager.prototype.render">
        function <span class="apidocSignatureSpan">vision.manager.prototype.</span>render
        <span class="apidocSignatureSpan">(filename, context, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">render = function (filename, context, options, callback) {

    if (!callback) {
        return internals._wrapMethod(this, this.render, [filename, context, options]);
    }

    this._prepare(filename, options, (err, compiled) =&#x3e; {

        if (err) {
            return callback(err);
        }

        this._render(compiled, context, null, (err, rendered) =&#x3e; {

            if (err) {
                return callback(err);
            }

            return callback(null, rendered, compiled.settings);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        html: {
            compile: function (template) {

                Mustache.parse(template);

                return function (context) {

                    return Mustache.<span class="apidocCodeKeywordSpan">render</span>(template, context);
                };
            }
        }
    },
    relativeTo: __dirname,
    path: &#x27;templates&#x27;
});
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
